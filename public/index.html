<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#1a2a4a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Fish for People</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<!-- ===================== SPLASH / ROLE SCREEN ===================== -->
<div id="screen-splash" class="screen active">
  <div class="splash-wrap">
    <div class="splash-logo">ğŸŸ</div>
    <h1 class="splash-title">Fish for People</h1>
    <p class="splash-subtitle">Saddleback Church Â· Hong Kong</p>
    <p class="splash-prompt">I am aâ€¦</p>
    <div class="role-btns">
      <button class="role-btn" onclick="setRole('welcome')">
        <span class="role-icon">ğŸ‘‹</span>
        <span class="role-label">Welcome Team</span>
        <span class="role-desc">Manage seats, requests &amp; headcount</span>
      </button>
      <button class="role-btn" onclick="setRole('congregation')">
        <span class="role-icon">ğŸ™</span>
        <span class="role-label">Congregation</span>
        <span class="role-desc">Submit a request for help</span>
      </button>
    </div>
    <p class="splash-version">v1.0 Â· Fish for People</p>
  </div>
</div>

<!-- ===================== MAIN APP ===================== -->
<div id="screen-app" class="screen">

  <!-- Top bar -->
  <header class="topbar">
    <button class="topbar-back" id="topbar-back" onclick="goHome()" title="Change role">âŸµ</button>
    <div class="topbar-title" id="topbar-title">Fish for People</div>
    <div class="topbar-role" id="topbar-role">Welcome Team</div>
  </header>

  <!-- Tab contents -->
  <main class="main-content" id="main-content">

    <!-- ===== TAB 1: SEATS ===== -->
    <div class="tab-pane" id="tab-seats">
      <!-- Welcome team view: full seat map -->
      <div id="seats-welcome-view">
        <div class="section-header">
          <h2>Seat Availability</h2>
          <div class="seats-legend">
            <span class="legend-item"><span class="dot dot-available"></span>Available</span>
            <span class="legend-item"><span class="dot dot-occupied"></span>Occupied</span>
            <span class="legend-item"><span class="dot dot-request"></span>Request</span>
          </div>
        </div>

        <div class="seats-summary" id="seats-summary">
          <div class="summary-card">
            <div class="summary-num" id="sum-available">â€”</div>
            <div class="summary-lbl">Available</div>
          </div>
          <div class="summary-card">
            <div class="summary-num" id="sum-occupied">â€”</div>
            <div class="summary-lbl">Occupied</div>
          </div>
          <div class="summary-card">
            <div class="summary-num" id="sum-total">368</div>
            <div class="summary-lbl">Total</div>
          </div>
        </div>

        <div class="stage-label">ğŸ¤ STAGE</div>

        <div class="floor-plan" id="floor-plan">
          <!-- Generated by JS -->
        </div>

        <div class="row-counts-wrap">
          <h3 class="row-counts-title">Row-by-Row Count</h3>
          <div id="row-counts-table"></div>
        </div>

        <div class="seats-actions">
          <button class="btn btn-secondary" onclick="resetSeats()">Reset All Seats</button>
        </div>
      </div>
    </div>

    <!-- ===== TAB 2: REQUESTS ===== -->
    <div class="tab-pane" id="tab-requests">

      <!-- Congregation: Submit request -->
      <div id="requests-submit-view">
        <div class="section-header">
          <h2>Submit a Request</h2>
          <p class="section-subtitle">Let the welcome team know what you need</p>
        </div>

        <div class="form-card">
          <div class="form-group">
            <label class="form-label">Your Section</label>
            <div class="btn-group" id="req-section-group">
              <button class="choice-btn" data-val="Left" onclick="selectChoice(this,'req-section')">Left</button>
              <button class="choice-btn" data-val="Middle" onclick="selectChoice(this,'req-section')">Middle</button>
              <button class="choice-btn" data-val="Right" onclick="selectChoice(this,'req-section')">Right</button>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Your Row</label>
            <div class="row-picker-wrap">
              <select id="req-row" class="form-select">
                <option value="">â€” select row â€”</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">What do you need?</label>
            <div class="need-grid" id="req-need-group">
              <button class="need-btn" data-val="pen" onclick="selectChoice(this,'req-need')">
                <span class="need-icon">âœï¸</span>Pen
              </button>
              <button class="need-btn" data-val="sermon_notes" onclick="selectChoice(this,'req-need')">
                <span class="need-icon">ğŸ“„</span>Sermon Notes
              </button>
              <button class="need-btn" data-val="water" onclick="selectChoice(this,'req-need')">
                <span class="need-icon">ğŸ’§</span>Water
              </button>
              <button class="need-btn" data-val="prayer" onclick="selectChoice(this,'req-need')">
                <span class="need-icon">ğŸ™</span>Prayer
              </button>
              <button class="need-btn" data-val="other" onclick="selectChoice(this,'req-need')">
                <span class="need-icon">â“</span>Other
              </button>
            </div>
          </div>

          <div class="form-group" id="req-note-group" style="display:none">
            <label class="form-label">Additional note (optional)</label>
            <textarea id="req-note" class="form-textarea" placeholder="Describe your requestâ€¦" rows="3"></textarea>
          </div>

          <button class="btn btn-primary btn-full" onclick="submitRequest()">Submit Request</button>
        </div>

        <div class="success-toast" id="req-success" style="display:none">
          <span>âœ… Request sent! A team member will assist you shortly.</span>
        </div>
      </div>

      <!-- Welcome team: Request dashboard -->
      <div id="requests-dashboard-view" style="display:none">
        <div class="section-header">
          <h2>Active Requests</h2>
          <div class="header-actions">
            <span class="badge-count" id="requests-count">0 active</span>
            <button class="btn btn-sm btn-ghost" onclick="toggleShowResolved()">Show Resolved</button>
          </div>
        </div>
        <div id="requests-list">
          <div class="empty-state">No active requests ğŸ‰</div>
        </div>
      </div>

    </div>

    <!-- ===== TAB 3: HEADCOUNT ===== -->
    <div class="tab-pane" id="tab-headcount">
      <div class="section-header">
        <h2>Headcount</h2>
        <p class="section-subtitle" id="headcount-subtitle">Enter your count for each zone</p>
      </div>

      <!-- Counter ID selection -->
      <div id="headcount-id-select" class="form-card">
        <p class="form-label" style="margin-bottom:12px">Who are you?</p>
        <div class="btn-group">
          <button class="choice-btn" data-val="1" onclick="selectCounter(1)">Counter 1</button>
          <button class="choice-btn" data-val="2" onclick="selectCounter(2)">Counter 2</button>
        </div>
        <div class="form-group" style="margin-top:16px">
          <label class="form-label">Your name (optional)</label>
          <input type="text" id="counter-name" class="form-input" placeholder="e.g. Sarah" maxlength="40" />
        </div>
        <button class="btn btn-primary" style="margin-top:8px;width:100%" onclick="confirmCounter()">Continue</button>
      </div>

      <!-- Count entry form -->
      <div id="headcount-entry" style="display:none">
        <div class="form-card">
          <p class="hc-counter-label" id="hc-who-label">Counter 1</p>
          <div class="zone-grid">
            <div class="zone-row">
              <label class="zone-label">Left Section</label>
              <div class="zone-stepper">
                <button class="step-btn" onclick="stepZone('left',-1)">âˆ’</button>
                <input type="number" id="hc-left" class="zone-input" value="0" min="0" max="999" oninput="updateHCTotal()" />
                <button class="step-btn" onclick="stepZone('left',1)">+</button>
              </div>
            </div>
            <div class="zone-row">
              <label class="zone-label">Middle Section</label>
              <div class="zone-stepper">
                <button class="step-btn" onclick="stepZone('middle',-1)">âˆ’</button>
                <input type="number" id="hc-middle" class="zone-input" value="0" min="0" max="999" oninput="updateHCTotal()" />
                <button class="step-btn" onclick="stepZone('middle',1)">+</button>
              </div>
            </div>
            <div class="zone-row">
              <label class="zone-label">Right Section</label>
              <div class="zone-stepper">
                <button class="step-btn" onclick="stepZone('right',-1)">âˆ’</button>
                <input type="number" id="hc-right" class="zone-input" value="0" min="0" max="999" oninput="updateHCTotal()" />
                <button class="step-btn" onclick="stepZone('right',1)">+</button>
              </div>
            </div>
            <div class="zone-row">
              <label class="zone-label">Production Room</label>
              <div class="zone-stepper">
                <button class="step-btn" onclick="stepZone('production',-1)">âˆ’</button>
                <input type="number" id="hc-production" class="zone-input" value="0" min="0" max="999" oninput="updateHCTotal()" />
                <button class="step-btn" onclick="stepZone('production',1)">+</button>
              </div>
            </div>
            <div class="zone-row">
              <label class="zone-label">Outside / Lobby</label>
              <div class="zone-stepper">
                <button class="step-btn" onclick="stepZone('outside',-1)">âˆ’</button>
                <input type="number" id="hc-outside" class="zone-input" value="0" min="0" max="999" oninput="updateHCTotal()" />
                <button class="step-btn" onclick="stepZone('outside',1)">+</button>
              </div>
            </div>
          </div>
          <div class="hc-total-row">
            <span class="hc-total-label">My Total</span>
            <span class="hc-total-val" id="hc-my-total">0</span>
          </div>
          <button class="btn btn-primary btn-full" onclick="submitHeadcount()">Submit My Count</button>
        </div>
      </div>

      <!-- Comparison view -->
      <div id="headcount-compare" style="display:none">
        <div class="form-card hc-compare-card">
          <h3 class="compare-title">Counts Comparison</h3>

          <div class="compare-table" id="hc-compare-table">
            <!-- Generated by JS -->
          </div>

          <div id="hc-discrepancy-banner" class="discrepancy-banner" style="display:none">
            âš ï¸ Counts differ by more than 5% â€” please verify before confirming.
          </div>

          <div id="hc-confirm-section">
            <p class="confirm-prompt">Confirm the final attendance total:</p>
            <div class="final-total-wrap">
              <input type="number" id="hc-final-total" class="final-total-input" placeholder="0" min="0" />
              <span class="final-total-unit">people</span>
            </div>
            <button class="btn btn-primary btn-full" onclick="confirmFinalCount()" id="btn-confirm-hc">Confirm &amp; Save</button>
          </div>

          <div id="hc-saved-banner" class="saved-banner" style="display:none">
            âœ… Attendance saved!
          </div>

          <div class="recent-counts" id="recent-counts-wrap" style="margin-top:24px">
            <h4>Recent Services</h4>
            <div id="recent-counts-list"></div>
          </div>
        </div>
      </div>
    </div>

  </main><!-- /main-content -->

  <!-- Bottom Nav -->
  <nav class="bottom-nav" id="bottom-nav">
    <button class="nav-btn active" id="nav-seats" onclick="switchTab('seats')">
      <span class="nav-icon">ğŸ’º</span>
      <span class="nav-label">Seats</span>
    </button>
    <button class="nav-btn" id="nav-requests" onclick="switchTab('requests')">
      <span class="nav-icon">ğŸ™‹</span>
      <span class="nav-label">Requests</span>
      <span class="nav-badge" id="nav-badge-requests" style="display:none">0</span>
    </button>
    <button class="nav-btn" id="nav-headcount" onclick="switchTab('headcount')">
      <span class="nav-icon">ğŸ”¢</span>
      <span class="nav-label">Headcount</span>
    </button>
  </nav>

</div><!-- /screen-app -->

<!-- Firebase SDKs (compat v9) -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<!-- App config -->
<script src="config.js"></script>

<!-- App logic -->
<script src="app.js"></script>

</body>
</html>
